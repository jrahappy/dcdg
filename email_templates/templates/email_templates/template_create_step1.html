{% extends 'dashboard/base_daisyui.html' %}
{% load form_filters %}

{% block title %}Create Email Template - Step 1{% endblock %}

{% block dashboard_content %}
<div class="max-w-7xl mx-auto">
    <!-- Breadcrumbs -->
    <div class="text-sm breadcrumbs mb-4">
        <ul>
            <li>
                <a href="{% url 'dashboard:home' %}" class="link link-hover">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                </a>
            </li>
            <li><a href="{% url 'email_templates:template_list' %}" class="link link-hover">Email Templates</a></li>
            <li>Create New Template</li>
        </ul>
    </div>

    <!-- Progress Steps -->
    <div class="mb-8">
        <ul class="steps w-full">
            <li class="step step-primary">Basic Information</li>
            <li class="step">Template Variables</li>
        </ul>
    </div>

    <!-- Header Card -->
    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                <div class="flex-1">
                    <h1 class="text-3xl font-bold">Create Email Template</h1>
                    <p class="text-base-content/60 mt-2">
                        Step 1 of 2: Set up basic template information and content
                    </p>
                </div>
                <div class="flex gap-2">
                    <a href="{% url 'email_templates:template_list' %}" class="btn btn-ghost">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                        Cancel
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Form -->
    <form method="post" class="space-y-6">
        {% csrf_token %}
        
        <!-- Basic Information Card -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Basic Information
                </h2>
                
                <div class="space-y-4">
                    <div class="form-control">
                        <label class="label" for="{{ form.title.id_for_label }}">
                            <span class="label-text font-semibold">Template Title <span class="text-error">*</span></span>
                        </label>
                        {{ form.title|add_class:"input input-bordered w-full" }}
                        {% if form.title.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.title.errors.0 }}</span>
                            </label>
                        {% endif %}
                    </div>

                    <div class="form-control">
                        <label class="label" for="{{ form.subject.id_for_label }}">
                            <span class="label-text font-semibold">Email Subject <span class="text-error">*</span></span>
                        </label>
                        {{ form.subject|add_class:"input input-bordered w-full" }}
                        {% if form.subject.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.subject.errors.0 }}</span>
                            </label>
                        {% endif %}
                        <label class="label">
                            <span class="label-text-alt">You can use variables like {% templatetag openvariable %}first_name{% templatetag closevariable %} in the subject</span>
                        </label>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-control">
                            <label class="label" for="{{ form.sender_email.id_for_label }}">
                                <span class="label-text font-semibold">Sender Email</span>
                            </label>
                            {{ form.sender_email|add_class:"select select-bordered w-full" }}
                            {% if form.sender_email.errors %}
                                <label class="label">
                                    <span class="label-text-alt text-error">{{ form.sender_email.errors.0 }}</span>
                                </label>
                            {% endif %}
                            {% if not sender_emails %}
                                <div class="alert alert-warning mt-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                    <div>
                                        <span>No verified sender emails.</span>
                                        <a href="{% url 'sender-information' %}" class="link link-primary">Add one</a>
                                    </div>
                                </div>
                            {% endif %}
                        </div>

                        <div class="form-control">
                            <label class="label" for="{{ form.sender_name.id_for_label }}">
                                <span class="label-text font-semibold">Sender Name (Optional)</span>
                            </label>
                            {{ form.sender_name|add_class:"input input-bordered w-full" }}
                            {% if form.sender_name.errors %}
                                <label class="label">
                                    <span class="label-text-alt text-error">{{ form.sender_name.errors.0 }}</span>
                                </label>
                            {% endif %}
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-control">
                            <label class="label" for="{{ form.content_type.id_for_label }}">
                                <span class="label-text font-semibold">Content Type <span class="text-error">*</span></span>
                            </label>
                            {{ form.content_type|add_class:"select select-bordered w-full" }}
                            {% if form.content_type.errors %}
                                <label class="label">
                                    <span class="label-text-alt text-error">{{ form.content_type.errors.0 }}</span>
                                </label>
                            {% endif %}
                        </div>

                        <div class="form-control">
                            <label class="label" for="{{ form.status.id_for_label }}">
                                <span class="label-text font-semibold">Status <span class="text-error">*</span></span>
                            </label>
                            {{ form.status|add_class:"select select-bordered w-full" }}
                            {% if form.status.errors %}
                                <label class="label">
                                    <span class="label-text-alt text-error">{{ form.status.errors.0 }}</span>
                                </label>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Email Content Card -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                    </svg>
                    Email Content
                </h2>

                <div class="space-y-4">
                    <div id="html-content-section" class="form-control">
                        <label class="label" for="{{ form.html_content.id_for_label }}">
                            <span class="label-text font-semibold">HTML Content</span>
                        </label>
                        {{ form.html_content|add_class:"textarea textarea-bordered w-full h-64" }}
                        {% if form.html_content.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.html_content.errors.0 }}</span>
                            </label>
                        {% endif %}
                    </div>

                    <div id="plain-content-section" class="form-control">
                        <label class="label" for="{{ form.plain_content.id_for_label }}">
                            <span class="label-text font-semibold">Plain Text Content</span>
                        </label>
                        {{ form.plain_content|add_class:"textarea textarea-bordered w-full h-64" }}
                        {% if form.plain_content.errors %}
                            <label class="label">
                                <span class="label-text-alt text-error">{{ form.plain_content.errors.0 }}</span>
                            </label>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Tracking Settings Card -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    Tracking Settings
                </h2>
                
                <div class="space-y-4">
                    <div class="form-control">
                        <label class="cursor-pointer label">
                            {{ form.track_opens|add_class:"checkbox checkbox-primary" }}
                            <span class="label-text ml-3">Track email opens</span>
                        </label>
                    </div>

                    <div class="form-control">
                        <label class="cursor-pointer label">
                            {{ form.track_clicks|add_class:"checkbox checkbox-primary" }}
                            <span class="label-text ml-3">Track link clicks</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                    <a href="{% url 'email_templates:template_list' %}" class="btn btn-ghost">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                        Cancel
                    </a>
                    
                    <button type="submit" class="btn btn-primary">
                        Next: Add Template Variables
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
// Toggle content fields based on content type
document.addEventListener('DOMContentLoaded', function() {
    const contentTypeSelect = document.getElementById('{{ form.content_type.id_for_label }}');
    const htmlSection = document.getElementById('html-content-section');
    const plainSection = document.getElementById('plain-content-section');
    
    function toggleContentSections() {
        const contentType = contentTypeSelect.value;
        
        if (contentType === 'html') {
            htmlSection.style.display = 'block';
            plainSection.style.display = 'none';
        } else if (contentType === 'plain') {
            htmlSection.style.display = 'none';
            plainSection.style.display = 'block';
        } else {
            htmlSection.style.display = 'block';
            plainSection.style.display = 'block';
        }
    }
    
    contentTypeSelect.addEventListener('change', toggleContentSections);
    toggleContentSections(); // Initial toggle
});
</script>
{% endblock %}