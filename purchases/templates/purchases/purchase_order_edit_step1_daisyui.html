{% extends 'dashboard/base_daisyui.html' %}

{% block title %}Edit Purchase Order - Step 1{% endblock %}

{% block dashboard_content %}
<div class="space-y-6">
    <!-- Breadcrumb -->
    <div class="text-sm breadcrumbs">
        <ul>
            <li><a href="{% url 'dashboard:home' %}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
            </a></li>
            <li><a href="{% url 'purchases:purchase_order_list' %}">Purchase Orders</a></li>
            <li><a href="{% url 'purchases:purchase_order_detail' order.pk %}">{{ order.order_number }}</a></li>
            <li>Edit - Step 1</li>
        </ul>
    </div>

    <!-- Header with Progress Steps -->
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                <h1 class="text-2xl font-bold">Edit Purchase Order: {{ order.order_number }}</h1>
                
                <!-- Progress Steps -->
                <ul class="steps">
                    <li class="step step-primary">Select Supplier</li>
                    <li class="step">Edit Products</li>
                    <li class="step">Review & Save</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Instructions -->
    <div class="alert alert-info">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span>Update supplier and order dates for your purchase order.</span>
    </div>

    <form method="post">
        {% csrf_token %}
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Supplier Selection -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                        </svg>
                        Select Supplier
                    </h2>
                    
                    <div class="form-control w-full">
                        <label class="label">
                            <span class="label-text">Supplier <span class="text-error">*</span></span>
                        </label>
                        <select id="supplier_id" name="supplier_id" required class="select select-bordered">
                            <option value="">Select a supplier...</option>
                            {% for supplier in suppliers %}
                                <option value="{{ supplier.id }}" {% if supplier.id == order.supplier.id %}selected{% endif %}>
                                    {{ supplier.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Supplier Info Display -->
                    <div id="supplierInfo" class="mt-4">
                        <div class="bg-base-200 rounded-lg p-4">
                            <div class="grid grid-cols-1 gap-3">
                                <div>
                                    <span class="text-sm text-base-content/60">Contact Person:</span>
                                    <span id="contactPerson" class="text-sm font-medium ml-2">{{ order.supplier.contact_person|default:'-' }}</span>
                                </div>
                                <div>
                                    <span class="text-sm text-base-content/60">Email:</span>
                                    <span id="email" class="text-sm font-medium ml-2">{{ order.supplier.email|default:'-' }}</span>
                                </div>
                                <div>
                                    <span class="text-sm text-base-content/60">Phone:</span>
                                    <span id="phone" class="text-sm font-medium ml-2">{{ order.supplier.phone|default:'-' }}</span>
                                </div>
                                <div>
                                    <span class="text-sm text-base-content/60">Location:</span>
                                    <span id="location" class="text-sm font-medium ml-2">
                                        {% if order.supplier.city %}{{ order.supplier.city }}{% endif %}{% if order.supplier.city and order.supplier.state %}, {% endif %}{% if order.supplier.state %}{{ order.supplier.state }}{% endif %}{% if order.supplier.country %}, {{ order.supplier.get_country_display }}{% endif %}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Order Dates -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        Order Dates
                    </h2>
                    
                    <div class="space-y-4">
                        <div class="form-control w-full">
                            <label class="label">
                                <span class="label-text">Order Date <span class="text-error">*</span></span>
                            </label>
                            <input type="date" 
                                   id="order_date" 
                                   name="order_date" 
                                   required
                                   value="{{ order.order_date|date:'Y-m-d' }}"
                                   class="input input-bordered">
                        </div>
                        
                        <div class="form-control w-full">
                            <label class="label">
                                <span class="label-text">Expected Delivery Date</span>
                            </label>
                            <input type="date" 
                                   id="expected_delivery_date" 
                                   name="expected_delivery_date"
                                   value="{% if order.expected_delivery_date %}{{ order.expected_delivery_date|date:'Y-m-d' }}{% endif %}"
                                   class="input input-bordered">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="flex justify-between mt-8">
            <button type="button" 
                    onclick="window.location.href='{% url 'purchases:purchase_order_detail' order.pk %}'"
                    class="btn btn-ghost">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
                Cancel
            </button>
            <button type="submit" class="btn btn-primary">
                Next: Edit Products
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                </svg>
            </button>
        </div>
    </form>
</div>

<script>
// Supplier data
const suppliersData = {
    {% for supplier in suppliers %}
    {{ supplier.id }}: {
        contactPerson: "{{ supplier.contact_person|default:'-'|escapejs }}",
        email: "{{ supplier.email|default:'-'|escapejs }}",
        phone: "{{ supplier.phone|default:'-'|escapejs }}",
        city: "{{ supplier.city|default:''|escapejs }}",
        state: "{{ supplier.state|default:''|escapejs }}",
        country: "{{ supplier.get_country_display|default:''|escapejs }}"
    },
    {% endfor %}
};

// Show supplier info when selected
document.getElementById('supplier_id').addEventListener('change', function() {
    const supplierId = this.value;
    const supplierInfo = document.getElementById('supplierInfo');
    
    if (supplierId && suppliersData[supplierId]) {
        const data = suppliersData[supplierId];
        document.getElementById('contactPerson').textContent = data.contactPerson;
        document.getElementById('email').textContent = data.email;
        document.getElementById('phone').textContent = data.phone;
        
        // Build location string
        let location = [];
        if (data.city) location.push(data.city);
        if (data.state) location.push(data.state);
        if (data.country) location.push(data.country);
        document.getElementById('location').textContent = location.join(', ') || '-';
        
        supplierInfo.style.display = 'block';
    } else {
        // Show default values when no supplier selected
        document.getElementById('contactPerson').textContent = '-';
        document.getElementById('email').textContent = '-';
        document.getElementById('phone').textContent = '-';
        document.getElementById('location').textContent = '-';
    }
});
</script>
{% endblock %}