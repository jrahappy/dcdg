{% extends 'customer_portal/base.html' %}
{% load widget_tweaks %}

{% block account_page_title %}Security - Change Password{% endblock %}

{% block account_content %}
<!-- Breadcrumb -->
<div class="breadcrumbs text-sm mb-6">
    <ul>
        <li><a href="{% url 'customer_portal:dashboard' %}">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
        </a></li>
        <li>Security</li>
    </ul>
</div>

<!-- Page Header -->
<div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">Security Settings</h1>
    <p class="mt-2 text-sm text-gray-600">Manage your account security and change your password</p>
</div>

<!-- Change Password Form -->
<form method="post" class="max-w-3xl">
    {% csrf_token %}
    
    {% if form.non_field_errors %}
    <div class="alert alert-error mb-6">
        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <div>
            <h3 class="font-bold">Error</h3>
            <span>{{ form.non_field_errors.0 }}</span>
        </div>
    </div>
    {% endif %}
    
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-success mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>{{ message }}</span>
        </div>
        {% endfor %}
    {% endif %}
    
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <h2 class="card-title mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
                </svg>
                Change Password
            </h2>
            
            <!-- Current Password -->
            <div class="form-control w-full">
                <label class="label">
                    <span class="label-text">Current Password <span class="text-error">*</span></span>
                </label>
                {{ form.old_password|add_class:"input input-bordered w-full"|add_error_class:"input-error" }}
                {% if form.old_password.errors %}
                <label class="label">
                    <span class="label-text-alt text-error">{{ form.old_password.errors.0 }}</span>
                </label>
                {% endif %}
            </div>
            
            <div class="divider"></div>
            
            <!-- New Password -->
            <div class="form-control w-full">
                <label class="label">
                    <span class="label-text">New Password <span class="text-error">*</span></span>
                </label>
                {{ form.new_password1|add_class:"input input-bordered w-full"|add_error_class:"input-error" }}
                <div id="password-strength" class="mt-2"></div>
                {% if form.new_password1.errors %}
                <label class="label">
                    <span class="label-text-alt text-error">{{ form.new_password1.errors.0 }}</span>
                </label>
                {% endif %}
                {% if form.new_password1.help_text %}
                <label class="label">
                    <span class="label-text-alt">{{ form.new_password1.help_text }}</span>
                </label>
                {% endif %}
            </div>
            
            <!-- Confirm New Password -->
            <div class="form-control w-full mt-4">
                <label class="label">
                    <span class="label-text">Confirm New Password <span class="text-error">*</span></span>
                </label>
                {{ form.new_password2|add_class:"input input-bordered w-full"|add_error_class:"input-error" }}
                {% if form.new_password2.errors %}
                <label class="label">
                    <span class="label-text-alt text-error">{{ form.new_password2.errors.0 }}</span>
                </label>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Password Requirements -->
    <div class="card bg-base-100 shadow-xl mt-6">
        <div class="card-body">
            <h3 class="text-lg font-semibold mb-4">Password Requirements</h3>
            <ul class="space-y-2">
                <li class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-info mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span class="text-sm">At least 8 characters long</span>
                </li>
                <li class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-info mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span class="text-sm">Cannot be too similar to your personal information</span>
                </li>
                <li class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-info mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span class="text-sm">Cannot be a commonly used password</span>
                </li>
                <li class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-info mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span class="text-sm">Cannot be entirely numeric</span>
                </li>
            </ul>
        </div>
    </div>
    
    <!-- Security Tips -->
    <div class="alert alert-info mt-6">
        <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <div>
            <h3 class="font-bold">Security Tips</h3>
            <ul class="text-xs mt-2 space-y-1">
                <li>• Use a unique password that you don't use on other sites</li>
                <li>• Consider using a password manager</li>
                <li>• Enable two-factor authentication for extra security</li>
                <li>• Change your password regularly</li>
            </ul>
        </div>
    </div>
    
    <!-- Form Actions -->
    <div class="flex justify-end gap-4 mt-6">
        <a href="{% url 'customer_portal:profile' %}" class="btn btn-ghost">
            Cancel
        </a>
        <button type="submit" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Update Password
        </button>
    </div>
</form>

<!-- Additional Security Options -->
<div class="card bg-base-100 shadow-xl mt-8">
    <div class="card-body">
        <h3 class="card-title mb-4">Additional Security Options</h3>
        <div class="grid grid-cols-1 gap-4">
            <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                <div>
                    <h4 class="font-semibold">Two-Factor Authentication</h4>
                    <p class="text-sm text-gray-600 mt-1">Add an extra layer of security to your account</p>
                </div>
                <button class="btn btn-sm btn-outline" disabled>
                    Coming Soon
                </button>
            </div>
            
            <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                <div>
                    <h4 class="font-semibold">Login History</h4>
                    <p class="text-sm text-gray-600 mt-1">Review recent login activity</p>
                </div>
                <button class="btn btn-sm btn-outline" disabled>
                    Coming Soon
                </button>
            </div>
            
            <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                <div>
                    <h4 class="font-semibold">Active Sessions</h4>
                    <p class="text-sm text-gray-600 mt-1">Manage devices where you're logged in</p>
                </div>
                <button class="btn btn-sm btn-outline" disabled>
                    Coming Soon
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Password strength indicator
document.addEventListener('DOMContentLoaded', function() {
    const newPassword1 = document.getElementById('id_new_password1');
    const strengthDiv = document.getElementById('password-strength');
    
    if (newPassword1 && strengthDiv) {
        newPassword1.addEventListener('input', function() {
            const password = this.value;
            let strength = 0;
            let message = '';
            let badgeClass = '';
            
            if (password.length >= 8) strength++;
            if (password.match(/[a-z]+/)) strength++;
            if (password.match(/[A-Z]+/)) strength++;
            if (password.match(/[0-9]+/)) strength++;
            if (password.match(/[$@#&!]+/)) strength++;
            
            switch(strength) {
                case 0:
                case 1:
                    message = 'Weak';
                    badgeClass = 'badge-error';
                    break;
                case 2:
                case 3:
                    message = 'Fair';
                    badgeClass = 'badge-warning';
                    break;
                case 4:
                    message = 'Good';
                    badgeClass = 'badge-info';
                    break;
                case 5:
                    message = 'Strong';
                    badgeClass = 'badge-success';
                    break;
            }
            
            if (password.length > 0) {
                strengthDiv.innerHTML = `<span class="badge ${badgeClass}">Password Strength: ${message}</span>`;
            } else {
                strengthDiv.innerHTML = '';
            }
        });
    }
});
</script>
{% endblock %}